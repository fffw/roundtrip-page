<html>
<head>
<script type="text/javascript">
function metricForPage(url) {
  var now = new Date().getTime();
  var fetchStart = performance.timing.fetchStart - performance.timing.navigationStart;
  var domainLookupEnd = performance.timing.domainLookupEnd - performance.timing.navigationStart;
  var connectEnd = performance.timing.connectEnd - performance.timing.navigationStart;
  var responseEnd = performance.timing.responseEnd - performance.timing.navigationStart;
  var domComplete = performance.timing.domComplete - performance.timing.navigationStart;
  var total = now - performance.timing.navigationStart;
  var line =
    '  <td>' +
    '    <span>' + url + '</span>' +
    '  </td>' +
    '  <td>' +
    '    <span>' + fetchStart + 'ms</span>' +
    '  </td>' +
    '  <td>' +
    '    <span>' + domainLookupEnd + 'ms</span>' +
    '  </td>' +
    '  <td>' +
    '    <span>' + connectEnd + 'ms</span>' +
    '  </td>' +
    '  <td>' +
    '    <span>' + responseEnd + 'ms</span>' +
    '  </td>' +
    '  <td>' +
    '    <span>' + domComplete + 'ms</span>' +
    '  </td>' +
    '  <td>' +
    '    <span>' + total + 'ms</span>' +
    '  </td>';
  var child = document.createElement("tr");
  child.innerHTML = line;
  var el = document.getElementById("result");
  el.appendChild(child);
}

function metricForAjax(url) {
  var xhr = new XMLHttpRequest();
  var start = new Date().getTime();
  var unitialized = '', loading = '', loaded = '', interactive = '', completed = '';
  xhr.onreadystatechange = function(){
    var cur = new Date().getTime();
    switch (xhr.readyState) {
      case 1:
        loading = cur-start;
      break;
      case 2:
        loaded = cur-start;
      break;
      case 3:
        interactive = cur-start;
      break;
      case 4:
        {
        completed = cur-start;
        var line =
          '  <td>' +
          '    <span>' + url + '</span>' +
          '  </td>' +
          '  <td>' +
          '    <span>' + loading + 'ms</span>' +
          '  </td>' +
          '  <td>' +
          '    <span></span>' +
          '  </td>' +
          '  <td>' +
          '    <span></span>' +
          '  </td>' +
          '  <td>' +
          '    <span>' + loaded + 'ms</span>' +
          '  </td>' +
          '  <td>' +
          '    <span>' + interactive + 'ms</span>' +
          '  </td>' +
          '  <td>' +
          '    <span>' + completed + 'ms</span>' +
          '  </td>';
        var child = document.createElement("tr");
        child.innerHTML = line;
        var el = document.getElementById("result");
        el.appendChild(child);
        if (xhr.status == 200 ) {
        } else {
          console.error( xhr.status + xhr.statusText );
        }
        break;
      }
    }
  };
  xhr.open('GET', url);
  xhr.send();
}

function onLoad() {
  metricForPage(document.location);
  el = document.getElementById("ajax");
  el.onclick = function(evt) {
    evt.preventDefault();
    var url = document.getElementById("url").value;
    metricForAjax(url);
  }
}

</script>
</head>
<body onload="onLoad()">
<form action="">
  <label>URL to fetch(CORS):</label>
  <input id="url" type="url"/>
  <button id="ajax">Fetch</button>
</form>
<table id="result">
  <tr>
    <th>URL</th>
    <th>Fetch start</th>
    <th>DNS resolve end</th>
    <th>TCP connected</th>
    <th>Doc received</th>
    <th>Dom ready</th>
    <th>Total</th>
  </tr>
</table>
</body>
</html>
